!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-dataflow"),require("vega-scenegraph"),require("vega-util")):"function"==typeof define&&define.amd?define(["exports","vega-dataflow","vega-scenegraph","vega-util"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).vega=e.vega||{},e.vega.transforms={}),e.vega,e.vega,e.vega)}(this,(function(e,t,n,r){"use strict";const o="top",a="left",i="right",s="bottom",u="start",c="middle",d="end",l="group",h="axis",f="title",m="frame",y="scope",b="legend",x="row-header",g="row-footer",p="row-title",w="column-header",k="column-footer",M="column-title",v="padding",T="fit",E="fit-x",_="fit-y",A="none",z="all",B="each",D="flush",O="column",j="row";function q(e){t.Transform.call(this,null,e)}function S(e,t,n){return t(e.bounds.clear(),e,n)}r.inherits(q,t.Transform,{transform(e,t){const r=t.dataflow,o=e.mark,a=o.marktype,i=n.Marks[a],s=i.bound;let u,c=o.bounds;if(i.nested)o.items.length&&r.dirty(o.items[0]),c=S(o,s),o.items.forEach(e=>{e.bounds.clear().union(c)});else if(a===l||e.modified())switch(t.visit(t.MOD,e=>r.dirty(e)),c.clear(),o.items.forEach(e=>c.union(S(e,s))),o.role){case h:case b:case f:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,e=>{c.union(S(e,s))}),t.visit(t.MOD,e=>{u=u||c.alignsWith(e.bounds),r.dirty(e),c.union(S(e,s))}),u&&(c.clear(),o.items.forEach(e=>c.union(e.bounds)));return n.boundClip(o),t.modifies("bounds")}});const L=":vega_identifier:";function I(e){t.Transform.call(this,0,e)}function P(e){t.Transform.call(this,null,e)}function C(e){t.Transform.call(this,null,e)}I.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},r.inherits(I,t.Transform,{transform(e,t){const n=(o=t.dataflow)._signals[L]||(o._signals[L]=o.add(0)),r=e.as;var o;let a=n.value;return t.visit(t.ADD,e=>e[r]=e[r]||++a),n.set(this.value=a),t}}),r.inherits(P,t.Transform,{transform(e,t){let r=this.value;r||(r=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),r.group.context=e.context,e.context.group||(e.context.group=r.group),r.source=this.source,r.clip=e.clip,r.interactive=e.interactive,this.value=r);const o=r.marktype===l?n.GroupItem:n.Item;return t.visit(t.ADD,e=>o.call(e,r)),(e.modified("clip")||e.modified("interactive"))&&(r.clip=e.clip,r.interactive=!!e.interactive,r.zdirty=!0,t.reflow()),r.items=t.source,t}});const F={parity:e=>e.filter((e,t)=>t%2?e.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((e,r)=>r&&G(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1))}},G=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),H=(e,t)=>{for(var n,r=1,o=e.length,a=e[0].bounds;r<o;a=n,++r)if(G(a,n=e[r].bounds,t))return!0},R=e=>{var t=e.bounds;return t.width()>1&&t.height()>1},U=e=>(e.forEach(e=>e.opacity=1),e),V=(e,t)=>e.reflow(t.modified()).modifies("opacity");function W(e){t.Transform.call(this,null,e)}r.inherits(C,t.Transform,{transform(e,t){const a=F[e.method]||F.parity,i=e.separation||0;let u,c,d=t.materialize(t.SOURCE).source;if(!d||!d.length)return;if(!e.method)return e.modified("method")&&(U(d),t=V(t,e)),t;if(d=d.filter(R),!d.length)return;if(e.sort&&(d=d.slice().sort(e.sort)),u=U(d),t=V(t,e),u.length>=3&&H(u,i)){do{u=a(u,i)}while(u.length>=3&&H(u,i));u.length<3&&!r.peek(d).opacity&&(u.length>1&&(r.peek(u).opacity=0),r.peek(d).opacity=1)}var l,h,f,m,y;e.boundScale&&e.boundTolerance>=0&&(l=e.boundScale,h=e.boundOrient,f=+e.boundTolerance,m=l.range(),y=new n.Bounds,h===o||h===s?y.set(m[0],-1/0,m[1],1/0):y.set(-1/0,m[0],1/0,m[1]),y.expand(f||1),c=e=>y.encloses(e.bounds),d.forEach(e=>{c(e)||(e.opacity=0)}));const b=u[0].mark.bounds.clear();return d.forEach(e=>{e.opacity&&b.union(e.bounds)}),t}}),r.inherits(W,t.Transform,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,e=>n.dirty(e)),t.fields&&t.fields.zindex){var r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const J=new n.Bounds;function K(e,t,n){return e[t]===n?0:(e[t]=n,1)}function N(e){var t=e.items[0].orient;return t===a||t===i}function Q(e,t,r,u){var c,d,l=t.items[0],h=l.datum,f=null!=l.translate?l.translate:.5,m=l.orient,y=function(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(h),b=l.range,x=l.offset,g=l.position,p=l.minExtent,w=l.maxExtent,k=h.title&&l.items[y[2]].items[0],M=l.titlePadding,v=l.bounds,T=k&&n.multiLineOffset(k),E=0,_=0;switch(J.clear().union(v),v.clear(),(c=y[0])>-1&&v.union(l.items[c].bounds),(c=y[1])>-1&&v.union(l.items[c].bounds),m){case o:E=g||0,_=-x,d=Math.max(p,Math.min(w,-v.y1)),v.add(0,-d).add(b,0),k&&X(e,k,d,M,T,0,-1,v);break;case a:E=-x,_=g||0,d=Math.max(p,Math.min(w,-v.x1)),v.add(-d,0).add(0,b),k&&X(e,k,d,M,T,1,-1,v);break;case i:E=r+x,_=g||0,d=Math.max(p,Math.min(w,v.x2)),v.add(0,0).add(d,b),k&&X(e,k,d,M,T,1,1,v);break;case s:E=g||0,_=u+x,d=Math.max(p,Math.min(w,v.y2)),v.add(0,0).add(b,d),k&&X(e,k,d,M,0,0,1,v);break;default:E=l.x,_=l.y}return n.boundStroke(v.translate(E,_),l),K(l,"x",E+f)|K(l,"y",_+f)&&(l.bounds=J,e.dirty(l),l.bounds=v,e.dirty(l)),l.mark.bounds.clear().union(v)}function X(e,t,n,r,o,a,i,s){const u=t.bounds;if(t.auto){const s=i*(n+o+r);let c=0,d=0;e.dirty(t),a?c=(t.x||0)-(t.x=s):d=(t.y||0)-(t.y=s),t.mark.bounds.clear().union(u.translate(-c,-d)),e.dirty(t)}s.union(u)}const Y=(e,t)=>Math.floor(Math.min(e,t)),Z=(e,t)=>Math.ceil(Math.max(e,t));function $(e){return(new n.Bounds).set(0,0,e.width||0,e.height||0)}function ee(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function te(e,t,n){var o=r.isObject(e)?e[t]:e;return null!=o?o:void 0!==n?n:0}function ne(e){return e<0?Math.ceil(-e):0}function re(e,t,n){var r,o,a,i,s,u,l,h,f,m,y,b=!n.nodirty,x=n.bounds===D?$:ee,g=J.set(0,0,0,0),p=te(n.align,O),w=te(n.align,j),k=te(n.padding,O),M=te(n.padding,j),v=n.columns||t.length,T=v<=0?1:Math.ceil(t.length/v),E=t.length,_=Array(E),A=Array(v),q=0,S=Array(E),L=Array(T),I=0,P=Array(E),C=Array(E),F=Array(E);for(o=0;o<v;++o)A[o]=0;for(o=0;o<T;++o)L[o]=0;for(o=0;o<E;++o)u=t[o],s=F[o]=x(u),u.x=u.x||0,P[o]=0,u.y=u.y||0,C[o]=0,a=o%v,i=~~(o/v),q=Math.max(q,l=Math.ceil(s.x2)),I=Math.max(I,h=Math.ceil(s.y2)),A[a]=Math.max(A[a],l),L[i]=Math.max(L[i],h),_[o]=k+ne(s.x1),S[o]=M+ne(s.y1),b&&e.dirty(t[o]);for(o=0;o<E;++o)o%v==0&&(_[o]=0),o<v&&(S[o]=0);if(p===B)for(a=1;a<v;++a){for(y=0,o=a;o<E;o+=v)y<_[o]&&(y=_[o]);for(o=a;o<E;o+=v)_[o]=y+A[a-1]}else if(p===z){for(y=0,o=0;o<E;++o)o%v&&y<_[o]&&(y=_[o]);for(o=0;o<E;++o)o%v&&(_[o]=y+q)}else for(p=!1,a=1;a<v;++a)for(o=a;o<E;o+=v)_[o]+=A[a-1];if(w===B)for(i=1;i<T;++i){for(y=0,r=(o=i*v)+v;o<r;++o)y<S[o]&&(y=S[o]);for(o=i*v;o<r;++o)S[o]=y+L[i-1]}else if(w===z){for(y=0,o=v;o<E;++o)y<S[o]&&(y=S[o]);for(o=v;o<E;++o)S[o]=y+I}else for(w=!1,i=1;i<T;++i)for(r=(o=i*v)+v;o<r;++o)S[o]+=L[i-1];for(f=0,o=0;o<E;++o)f=_[o]+(o%v?f:0),P[o]+=f-t[o].x;for(a=0;a<v;++a)for(m=0,o=a;o<E;o+=v)m+=S[o],C[o]+=m-t[o].y;if(p&&te(n.center,O)&&T>1)for(o=0;o<E;++o)(f=(s=p===z?q:A[o%v])-F[o].x2-t[o].x-P[o])>0&&(P[o]+=f/2);if(w&&te(n.center,j)&&1!==v)for(o=0;o<E;++o)(m=(s=w===z?I:L[~~(o/v)])-F[o].y2-t[o].y-C[o])>0&&(C[o]+=m/2);for(o=0;o<E;++o)g.union(F[o].translate(P[o],C[o]));switch(f=te(n.anchor,"x"),m=te(n.anchor,"y"),te(n.anchor,O)){case d:f-=g.width();break;case c:f-=g.width()/2}switch(te(n.anchor,j)){case d:m-=g.height();break;case c:m-=g.height()/2}for(f=Math.round(f),m=Math.round(m),g.clear(),o=0;o<E;++o)t[o].mark.bounds.clear();for(o=0;o<E;++o)(u=t[o]).x+=P[o]+=f,u.y+=C[o]+=m,g.union(u.mark.bounds.union(u.bounds.translate(P[o],C[o]))),b&&e.dirty(u);return g}function oe(e,t,n){var r,o,a,i,s,u,c,m=function(e){for(var t,n,r=e.items,o=r.length,a=0,i={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};a<o;++a)if(n=(t=r[a]).items,t.marktype===l)switch(t.role){case h:case b:case f:break;case x:i.rowheaders.push(...n);break;case g:i.rowfooters.push(...n);break;case w:i.colheaders.push(...n);break;case k:i.colfooters.push(...n);break;case p:i.rowtitle=n[0];break;case M:i.coltitle=n[0];break;default:i.marks.push(...n)}return i}(t),y=m.marks,v=n.bounds===D?ae:ie,T=n.offset,E=n.columns||y.length,_=E<=0?1:Math.ceil(y.length/E),A=_*E;const z=re(e,y,n);z.empty()&&z.set(0,0,0,0),m.rowheaders&&(u=te(n.headerBand,j,null),r=se(e,m.rowheaders,y,E,_,-te(T,"rowHeader"),Y,0,v,"x1",0,E,1,u)),m.colheaders&&(u=te(n.headerBand,O,null),o=se(e,m.colheaders,y,E,E,-te(T,"columnHeader"),Y,1,v,"y1",0,1,E,u)),m.rowfooters&&(u=te(n.footerBand,j,null),a=se(e,m.rowfooters,y,E,_,te(T,"rowFooter"),Z,0,v,"x2",E-1,E,1,u)),m.colfooters&&(u=te(n.footerBand,O,null),i=se(e,m.colfooters,y,E,E,te(T,"columnFooter"),Z,1,v,"y2",A-E,1,E,u)),m.rowtitle&&(s=te(n.titleAnchor,j),c=te(T,"rowTitle"),c=s===d?a+c:r-c,u=te(n.titleBand,j,.5),ue(e,m.rowtitle,c,0,z,u)),m.coltitle&&(s=te(n.titleAnchor,O),c=te(T,"columnTitle"),c=s===d?i+c:o-c,u=te(n.titleBand,O,.5),ue(e,m.coltitle,c,1,z,u))}function ae(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function ie(e,t){return e.bounds[t]}function se(e,t,n,r,o,a,i,s,u,c,d,l,h,f){var m,y,b,x,g,p,w,k,M,v=n.length,T=0,E=0;if(!v)return T;for(m=d;m<v;m+=l)n[m]&&(T=i(T,u(n[m],c)));if(!t.length)return T;for(t.length>o&&(e.warn("Grid headers exceed limit: "+o),t=t.slice(0,o)),T+=a,y=0,x=t.length;y<x;++y)e.dirty(t[y]),t[y].mark.bounds.clear();for(m=d,y=0,x=t.length;y<x;++y,m+=l){for(g=(p=t[y]).mark.bounds,b=m;b>=0&&null==(w=n[b]);b-=h);s?(k=null==f?w.x:Math.round(w.bounds.x1+f*w.bounds.width()),M=T):(k=T,M=null==f?w.y:Math.round(w.bounds.y1+f*w.bounds.height())),g.union(p.bounds.translate(k-(p.x||0),M-(p.y||0))),p.x=k,p.y=M,e.dirty(p),E=i(E,g[c])}return E}function ue(e,t,n,r,o,a){if(t){e.dirty(t);var i=n,s=n;r?i=Math.round(o.x1+a*o.width()):s=Math.round(o.y1+a*o.height()),t.bounds.translate(i-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=i,t.y=s,e.dirty(t)}}function ce(e,t,n,r,l,h,f){const m=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),y=function(e,t){var n=-1/0;return e.forEach(e=>{null!=e.offset&&(n=Math.max(n,e.offset))}),n>-1/0?n:t}(e,m("offset",0)),b=m("anchor",u),x=b===d?1:b===c?.5:0,g={align:B,bounds:m("bounds",D),columns:"vertical"===m("direction")?1:e.length,padding:m("margin",8),center:m("center"),nodirty:!0};switch(t){case a:g.anchor={x:Math.floor(r.x1)-y,column:d,y:x*(f||r.height()+2*r.y1),row:b};break;case i:g.anchor={x:Math.ceil(r.x2)+y,y:x*(f||r.height()+2*r.y1),row:b};break;case o:g.anchor={y:Math.floor(l.y1)-y,row:d,x:x*(h||l.width()+2*l.x1),column:b};break;case s:g.anchor={y:Math.ceil(l.y2)+y,x:x*(h||l.width()+2*l.x1),column:b};break;case"top-left":g.anchor={x:y,y:y};break;case"top-right":g.anchor={x:h-y,y:y,column:d};break;case"bottom-left":g.anchor={x:y,y:f-y,row:d};break;case"bottom-right":g.anchor={x:h-y,y:f-y,column:d,row:d}}return g}function de(e,t){var r,o,u,c,l=t.items[0],h=l.datum,f=l.orient,m=l.bounds,y=l.x,b=l.y;return l._bounds?l._bounds.clear().union(m):l._bounds=m.clone(),m.clear(),function(e,t,n){var r=t.padding,o=r-n.x,u=r-n.y;if(t.datum.title){var c=t.items[1].items[0],l=c.anchor,h=t.titlePadding||0,f=r-c.x,m=r-c.y;switch(c.orient){case a:o+=Math.ceil(c.bounds.width())+h;break;case i:case s:break;default:u+=c.bounds.height()+h}switch((o||u)&&he(e,n,o,u),c.orient){case a:m+=le(t,n,c,l,1,1);break;case i:f+=le(t,n,c,d,0,0)+h,m+=le(t,n,c,l,1,1);break;case s:f+=le(t,n,c,l,0,0),m+=le(t,n,c,d,-1,0,1)+h;break;default:f+=le(t,n,c,l,0,0)}(f||m)&&he(e,c,f,m),(f=Math.round(c.bounds.x1-r))<0&&(he(e,n,-f,0),he(e,c,-f,0))}else(o||u)&&he(e,n,o,u)}(e,l,l.items[0].items[0]),m=function(e,t){return e.items.forEach(e=>t.union(e.bounds)),t.x1=e.padding,t.y1=e.padding,t}(l,m),r=2*l.padding,o=2*l.padding,m.empty()||(r=Math.ceil(m.width()+r),o=Math.ceil(m.height()+o)),"symbol"===h.type&&(u=l.items[0].items[0].items[0].items,c=u.reduce((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e),{}),u.forEach(e=>{e.width=c[e.column],e.height=e.bounds.y2-e.y})),f!==A&&(l.x=y=0,l.y=b=0),l.width=r,l.height=o,n.boundStroke(m.set(y,b,y+r,b+o),l),l.mark.bounds.clear().union(m),l}function le(e,t,r,o,a,i,s){const c="symbol"!==e.datum.type,l=r.datum.vgrad,h=(!c||!i&&l||s?t:t.items[0]).bounds[a?"y2":"x2"]-e.padding,f=l&&i?h:0,m=l&&i?0:h,y=a<=0?0:n.multiLineOffset(r);return Math.round(o===u?f:o===d?m-y:.5*(h-y))}function he(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function fe(e){t.Transform.call(this,null,e)}r.inherits(fe,t.Transform,{transform(e,t){const r=t.dataflow;return e.mark.items.forEach(t=>{e.layout&&oe(r,t,e.layout),function(e,t,r){var c,z,B,D,O,j=t.items,q=Math.max(0,t.width||0),S=Math.max(0,t.height||0),L=(new n.Bounds).set(0,0,q,S),I=L.clone(),P=L.clone(),C=[];for(D=0,O=j.length;D<O;++D)switch((z=j[D]).role){case h:(N(z)?I:P).union(Q(e,z,q,S));break;case f:c=z;break;case b:C.push(de(e,z));break;case m:case y:case x:case g:case p:case w:case k:case M:I.union(z.bounds),P.union(z.bounds);break;default:L.union(z.bounds)}if(C.length){const t={};C.forEach(e=>{(B=e.orient||i)!==A&&(t[B]||(t[B]=[])).push(e)});for(const n in t){const o=t[n];re(e,o,ce(o,n,r.legends,I,P,q,S))}C.forEach(t=>{const n=t.bounds;if(n.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=n,e.dirty(t)),r.autosize&&r.autosize.type===T)switch(t.orient){case a:case i:L.add(n.x1,0).add(n.x2,0);break;case o:case s:L.add(0,n.y1).add(0,n.y2)}else L.union(n)})}L.union(I).union(P),c&&L.union(function(e,t,n,r,c){var h,f=t.items[0],m=f.frame,y=f.orient,b=f.anchor,x=f.offset,g=f.padding,p=f.items[0].items[0],w=f.items[1]&&f.items[1].items[0],k=y===a||y===i?r:n,M=0,v=0,T=0,E=0,_=0;if(m!==l?y===a?(M=c.y2,k=c.y1):y===i?(M=c.y1,k=c.y2):(M=c.x1,k=c.x2):y===a&&(M=r,k=0),h=b===u?M:b===d?k:(M+k)/2,w&&w.text){switch(y){case o:case s:_=p.bounds.height()+g;break;case a:E=p.bounds.width()+g;break;case i:E=-p.bounds.width()-g}J.clear().union(w.bounds),J.translate(E-(w.x||0),_-(w.y||0)),K(w,"x",E)|K(w,"y",_)&&(e.dirty(w),w.bounds.clear().union(J),w.mark.bounds.clear().union(J),e.dirty(w)),J.clear().union(w.bounds)}else J.clear();switch(J.union(p.bounds),y){case o:v=h,T=c.y1-J.height()-x;break;case a:v=c.x1-J.width()-x,T=h;break;case i:v=c.x2+J.width()+x,T=h;break;case s:v=h,T=c.y2+x;break;default:v=f.x,T=f.y}return K(f,"x",v)|K(f,"y",T)&&(J.translate(v,T),e.dirty(f),f.bounds.clear().union(J),t.bounds.clear().union(J),e.dirty(f)),f.bounds}(e,c,q,S,L));t.clip&&L.set(0,0,t.width||0,t.height||0);!function(e,t,n,r){const o=r.autosize||{},a=o.type;if(e._autosize<1||!a)return;let i=e._width,s=e._height,u=Math.max(0,t.width||0),c=Math.max(0,Math.ceil(-n.x1)),d=Math.max(0,t.height||0),l=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),f=Math.max(0,Math.ceil(n.y2-d));if(o.contains===v){const t=e.padding();i-=t.left+t.right,s-=t.top+t.bottom}a===A?(c=0,l=0,u=i,d=s):a===T?(u=Math.max(0,i-c-h),d=Math.max(0,s-l-f)):a===E?(u=Math.max(0,i-c-h),s=d+l+f):a===_?(i=u+c+h,d=Math.max(0,s-l-f)):"pad"===a&&(i=u+c+h,s=d+l+f);e._resizeView(i,s,u,d,[c,l],o.resize)}(e,t,L,r)}(r,t,e)}),(c=e.mark.group)&&"legend-entry"!==c.mark.role?t.reflow():t;var c}}),e.bound=q,e.identifier=I,e.mark=P,e.overlap=C,e.render=W,e.viewlayout=fe,Object.defineProperty(e,"__esModule",{value:!0})}));