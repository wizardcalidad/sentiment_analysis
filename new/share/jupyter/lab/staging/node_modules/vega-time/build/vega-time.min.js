!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("d3-time"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","vega-util","d3-time","d3-array"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vega={},e.vega,e.d3,e.d3)}(this,(function(e,t,n,r){"use strict";const o="year",u="quarter",i="month",c="week",a="date",s="day",f="dayofyear",l="hours",d="minutes",m="seconds",y="milliseconds",g=[o,u,i,c,a,s,f,l,d,m,y],D=g.reduce((e,t,n)=>(e[t]=1+n,e),{});function h(e){const n=t.array(e).slice(),r={};n.length||t.error("Missing time unit."),n.forEach(e=>{t.hasOwnProperty(D,e)?r[e]=1:t.error(`Invalid time unit: ${e}.`)});return(r.week||r.day?1:0)+(r.quarter||r.month||r.date?1:0)+(r.dayofyear?1:0)>1&&t.error("Incompatible time units: "+e),n.sort((e,t)=>D[e]-D[t]),n}const M={[o]:"%Y ",[u]:"Q%q ",[i]:"%b ",[a]:"%d ",[c]:"W%U ",[s]:"%a ",[f]:"%j ",[l]:"%H:00",[d]:"00:%M",[m]:":%S",[y]:".%L","year-month":"%Y-%m ","year-month-date":"%Y-%m-%d ","hours-minutes":"%H:%M"};const T=new Date;function U(e){return T.setFullYear(e),T.setMonth(0),T.setDate(1),T.setHours(0,0,0,0),T}function C(e){return n.timeDay.count(U(e.getFullYear())-1,e)}function S(e){return n.timeWeek.count(U(e.getFullYear())-1,e)}function Y(e){return U(e).getDay()}function w(e,t,n,r,o,u,i){if(0<=e&&e<100){const c=new Date(-1,t,n,r,o,u,i);return c.setFullYear(e),c}return new Date(e,t,n,r,o,u,i)}function p(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return n.utcDay.count(t-1,e)}function k(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return n.utcWeek.count(t-1,e)}function v(e){return T.setTime(Date.UTC(e,0,1)),T.getUTCDay()}function F(e,t,n,r,o,u,i){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,o,u,i));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,o,u,i))}function E(e,n,r,g,D){const h=n||1,M=t.peek(e),T=(e,t,n)=>function(e,t,n,r){const o=n<=1?e:r?(t,o)=>r+n*Math.floor((e(t,o)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(o(e,n),n):o}(r[n=n||e],g[n],e===M&&h,t),U=new Date,C=t.toSet(e),S=C.year?T(o):t.constant(2012),Y=C.month?T(i):C.quarter?T(u):t.zero,w=C.week&&C.day?T(s,1,c+s):C.week?T(c,1):C.day?T(s,1):C.date?T(a,1):C.dayofyear?T(f,1):t.one,p=C.hours?T(l):t.zero,k=C.minutes?T(d):t.zero,v=C.seconds?T(m):t.zero,F=C.milliseconds?T(y):t.zero;return function(e){U.setTime(+e);const t=S(U);return D(t,Y(U),w(U,t),p(U),k(U),v(U),F(U))}}function b(e,t,n){return t+7*e-(n+6)%7}const q={[o]:e=>e.getFullYear(),[u]:e=>Math.floor(e.getMonth()/3),[i]:e=>e.getMonth(),[a]:e=>e.getDate(),[l]:e=>e.getHours(),[d]:e=>e.getMinutes(),[m]:e=>e.getSeconds(),[y]:e=>e.getMilliseconds(),[f]:e=>C(e),[c]:e=>S(e),[c+s]:(e,t)=>b(S(e),e.getDay(),Y(t)),[s]:(e,t)=>b(1,e.getDay(),Y(t))},H={[u]:e=>3*e,[c]:(e,t)=>b(e,0,Y(t))};const I={[o]:e=>e.getUTCFullYear(),[u]:e=>Math.floor(e.getUTCMonth()/3),[i]:e=>e.getUTCMonth(),[a]:e=>e.getUTCDate(),[l]:e=>e.getUTCHours(),[d]:e=>e.getUTCMinutes(),[m]:e=>e.getUTCSeconds(),[y]:e=>e.getUTCMilliseconds(),[f]:e=>p(e),[c]:e=>k(e),[s]:(e,t)=>b(1,e.getUTCDay(),v(t)),[c+s]:(e,t)=>b(k(e),e.getUTCDay(),v(t))},O={[u]:e=>3*e,[c]:(e,t)=>b(e,0,v(t))};const x={[o]:n.timeYear,[u]:n.timeMonth.every(3),[i]:n.timeMonth,[c]:n.timeWeek,[a]:n.timeDay,[s]:n.timeDay,[f]:n.timeDay,[l]:n.timeHour,[d]:n.timeMinute,[m]:n.timeSecond,[y]:n.timeMillisecond},A={[o]:n.utcYear,[u]:n.utcMonth.every(3),[i]:n.utcMonth,[c]:n.utcWeek,[a]:n.utcDay,[s]:n.utcDay,[f]:n.utcDay,[l]:n.utcHour,[d]:n.utcMinute,[m]:n.utcSecond,[y]:n.utcMillisecond};function W(e){return x[e]}function z(e){return A[e]}function N(e,t,n){return e?e.offset(t,n):void 0}function R(e,t,n,r){return e?e.range(t,n,r):void 0}const j=1e3,L=6e4,_=36e5,P=864e5,Q=2592e6,B=31536e6,K=[o,i,a,l,d,m,y],$=K.slice(0,-1),G=$.slice(0,-1),J=G.slice(0,-1),V=J.slice(0,-1),X=[o,i],Z=[o],ee=[[$,1,j],[$,5,5e3],[$,15,15e3],[$,30,3e4],[G,1,L],[G,5,3e5],[G,15,9e5],[G,30,18e5],[J,1,_],[J,3,108e5],[J,6,216e5],[J,12,432e5],[V,1,P],[[o,c],1,6048e5],[X,1,Q],[X,3,7776e6],[Z,1,B]];e.DATE=a,e.DAY=s,e.DAYOFYEAR=f,e.HOURS=l,e.MILLISECONDS=y,e.MINUTES=d,e.MONTH=i,e.QUARTER=u,e.SECONDS=m,e.TIME_UNITS=g,e.WEEK=c,e.YEAR=o,e.dayofyear=function(e){return C(new Date(e))},e.timeBin=function(e){const n=e.extent,o=e.maxbins||40,u=Math.abs(t.span(n))/o;let i,c,a=r.bisector(e=>e[2]).right(ee,u);return a===ee.length?(i=Z,c=r.tickStep(n[0]/B,n[1]/B,o)):a?(a=ee[u/ee[a-1][2]<ee[a][2]/u?a-1:a],i=a[0],c=a[1]):(i=K,c=Math.max(r.tickStep(n[0],n[1],o),1)),{units:i,step:c}},e.timeFloor=function(e,t){return E(e,t||1,q,H,w)},e.timeInterval=W,e.timeOffset=function(e,t,n){return N(W(e),t,n)},e.timeSequence=function(e,t,n,r){return R(W(e),t,n,r)},e.timeUnitSpecifier=function(e,n){const r=t.extend({},M,n),o=h(e),u=o.length;let i,c,a="",s=0;for(s=0;s<u;)for(i=o.length;i>s;--i)if(c=o.slice(s,i).join("-"),null!=r[c]){a+=r[c],s=i;break}return a.trim()},e.timeUnits=h,e.utcFloor=function(e,t){return E(e,t||1,I,O,F)},e.utcInterval=z,e.utcOffset=function(e,t,n){return N(z(e),t,n)},e.utcSequence=function(e,t,n,r){return R(z(e),t,n,r)},e.utcdayofyear=function(e){return p(new Date(e))},e.utcweek=function(e){return k(new Date(e))},e.week=function(e){return S(new Date(e))},Object.defineProperty(e,"__esModule",{value:!0})}));